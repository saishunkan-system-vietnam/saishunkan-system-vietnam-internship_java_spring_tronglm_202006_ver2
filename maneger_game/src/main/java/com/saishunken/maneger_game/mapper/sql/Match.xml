<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.saishunken.maneger_game.mapper.MapperMatch">

	<insert id="insert" parameterType="Match"  useGeneratedKeys="true" keyColumn="id" keyProperty="id">

		INSERT INTO match1 (start_time, del_flg, status_flg, edit_date, create_date, place_match, end_time)
		VALUES (#{start_time}, #{del_flg}, #{status_flg}, #{edit_date}, #{create_date}, #{place_match}, #{end_time});
		
	</insert>

	<update id="update" parameterType="Match">
		UPDATE match1 SET	
		<if test="start_time != null">
			start_time = #{start_time},
		</if>
		
		<if test="end_time != null">
			end_time = #{end_time},
		</if>
		
		<if test="del_flg != null">
			del_flg = #{del_flg},
		</if>
		
		<if test="status_flg != null">
			status_flg = #{status_flg},
		</if>
		
		<if test="place_match != null">
			place_match = #{place_match},
		</if>
		edit_date = #{edit_date}
		WHERE id = #{id};
	</update>

	<select id="getById" parameterType="int"
		resultType="Match">
		SELECT * FROM match1 WHERE id = #{id};
	</select>
	
	<select id="getAllMatch" parameterType="int" resultMap="matchResultMap">
	  select 
	      m1.id as "m1_id",
	      m1.start_time as "m1_start_time",
	      m1.status_flg as "m1_status_flg",
	      m1.place_match as "m1_place_match",
	      
	      d1.id as "d1_id",
	      d1.id_team as "d1_id_team",
	      d1.id_match as "d1_id_match",
	      d1.result as "d1_result",
	      d1.win_flg as "d1_win_flg",
	      
	      t1.id as "t1_id",
	      t1.name_team as "t1_name_team",
	      t1.id_tournament as "t1_id_tournament"
	      
	  from match1 m1
	  
	  left join detail_match d1 on m1.id = d1.id_match
	  
	  inner join team t1 on d1.id_team = t1.id
	  
	  where t1.id_tournament = #{id} and m1.del_flg = 0 and d1.del_flg = 0 and t1.del_flg = 0
	</select>
	
	<select id="getMatchDetail" resultMap="matchResultMap">
	  select 
	      m1.id as "m1_id",
	      m1.start_time as "m1_start_time",
	      m1.status_flg as "m1_status_flg",
	      m1.place_match as "m1_place_match",
	      
	      d1.id as "d1_id",
	      d1.id_team as "d1_id_team",
	      d1.id_match as "d1_id_match",
	      d1.result as "d1_result",
	      d1.win_flg as "d1_win_flg",
	      
	      t1.id as "t1_id",
	      t1.name_team as "t1_name_team",
	      t1.id_tournament as "t1_id_tournament"
	      
	  from match1 m1
	  left join detail_match d1 on m1.id = d1.id_match
	  left join team t1 on d1.id_team = t1.id
	  where m1.id = #{id} and t1.id_tournament = #{id_tournament} and t1.del_flg = 0 and d1.del_flg = 0 and d1.del_flg = 0
	</select>
	
	<resultMap id="teamResultMap" type="Team">
		 <id property="id" column="t1_id" />  
		 <result property="name_team" column="t1_name_team" />
		 <result property="id_tournament" column="t1_id_tournament" />
	</resultMap>
	
	<resultMap id="detailMatchResultMap" type="Detail_match">
		 <id property="id" column="d1_id" />  
		 <result property="id_team" column="d1_id_team" />
		 <result property="id_match" column="d1_id_match" />
		 <result property="result" column="d1_result" />
		 <result property="win_flg" column="d1_win_flg" />
	</resultMap>

	<resultMap id="matchResultMap" type="Match">
		 <id property="id" column="m1_id" />  
		 <result property="start_time" column="m1_start_time" />
		 <result property="status_flg" column="m1_status_flg" />
		 <result property="place_match" column="m1_place_match" />
		 <collection property="teams" javaType="ArrayList" ofType="Team" resultMap="teamResultMap"></collection>
		 <collection property="listDetailMatch" javaType="ArrayList" ofType="Detail_match" resultMap="detailMatchResultMap"></collection>
	</resultMap>
	
</mapper>